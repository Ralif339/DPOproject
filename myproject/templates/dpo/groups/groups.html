{% extends "manager_navigation.html" %}
{% load static %}

{% block style %}
<style>
    .btn-add {
        background-color: #28a745;
        color: white;
    }
    .btn-add:hover {
        background-color: #218838;
    }
    .btn-apply {
        background-color: #9999FF;
        color: white;
    }
    .btn-apply:hover {
        background-color: #8888EE;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">–ì—Ä—É–ø–ø—ã —Å–ª—É—à–∞—Ç–µ–ª–µ–π</h2>
        <a href="{% url 'group_add' %}" class="btn btn-add">
            <i class="fas fa-plus me-1"></i> –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É
        </a>
    </div>

    <!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
    <form method="get" id="filterForm" class="mb-4">
        <div class="row g-2">
            <!-- –ü–æ–∏—Å–∫ -->
            <div class="col-md-3">
                <input type="text" name="search" class="form-control" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –≥—Ä—É–ø–ø–µ –∏–ª–∏ –∫—É—Ä—Å—É"
                       value="{{ current_search|default:'' }}">
            </div>
            
            <!-- –¢–∏–ø –∫—É—Ä—Å–∞ -->
            <div class="col-md-2">
                <select name="course_type" class="form-select">
                    <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                    {% for type in course_types %}
                    <option value="{{ type }}" {% if current_course_type == type %}selected{% endif %}>
                        {{ type }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å -->
            <div class="col-md-2">
                <select name="teacher" class="form-select">
                    <option value="">–í—Å–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏</option>
                    {% for teacher in teachers %}
                    <option value="{{ teacher.teacher__id }}" {% if current_teacher|stringformat:"s" == teacher.teacher__id|stringformat:"s" %}selected{% endif %}>
                        {{ teacher.teacher__surname }} {{ teacher.teacher__name.0 }}.
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- –°—Ç–∞—Ç—É—Å -->
            <div class="col-md-2">
                <select name="status" class="form-select">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    {% for status in statuses %}
                    <option value="{{ status }}" {% if current_status == status %}selected{% endif %}>
                        {{ status }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div class="col-md-2">
                <button type="submit" class="btn btn-apply w-100">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
            <div class="col-md-1">
                <a href="{% url 'groups' %}" class="btn btn-secondary w-100">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </div>
        </div>
    </form>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="table-light">
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ö—É—Ä—Å</th>
                    <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                    <th>–ü–µ—Ä–∏–æ–¥</th>
                    <th>–¢–∏–ø</th>
                    <th>–°–ª—É—à–∞—Ç–µ–ª–∏</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for group in groups %}
                <tr>
                    <td>{{ group.name }}</td>
                    <td>{{ group.course.course_name }}</td>
                    <td>{{ group.teacher.surname }} {{ group.teacher.name.0 }}.</td>
                    <td>{{ group.begin_date|date:"d.m.Y" }} - {{ group.finish_date|date:"d.m.Y" }}</td>
                    <td>{{ group.course.course_type }}</td>
                    <td class="text-center">{{ group.student_count }}</td>
                    <td>{{ group.status }}</td>
                    <td>
                        <a href="{% url 'group_detail' group.id %}" class="btn btn-sm btn-warning">‚úèÔ∏è</a>
                        <button onclick="confirmDelete({{ group.id }})" class="btn btn-sm btn-danger">üóëÔ∏è</button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center text-muted">–ù–µ—Ç –≥—Ä—É–ø–ø, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–∞–º</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function confirmDelete(groupId) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        window.location.href = `/groups/delete/${groupId}/`;
    }
}

// –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
document.querySelectorAll('#filterForm select').forEach(select => {
    select.addEventListener('change', function() {
        document.getElementById('filterForm').submit();
    });
});
</script>
{% endblock %}